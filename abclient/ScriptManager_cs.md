# Анализ ScriptManager.cs

**Расположение:** `abclient/ScriptManager.cs`

**Назначение:**
Этот класс служит мостом между JavaScript, выполняющимся в элементе управления `WebBrowser` C#, и логикой приложения C#. Он предоставляет методы, которые могут быть вызваны из JavaScript через объект `window.external`.

**Ключевые особенности:**

*   **`[ComVisible(true)]`**: Этот атрибут делает класс видимым для COM, что позволяет JavaScript взаимодействовать с ним через `window.external`. Это критически важно для функциональности клиента, так как многие функции игры, вероятно, управляются через вызовы JavaScript к этому интерфейсу.
*   **Публичные методы**: Все методы в этом классе являются `public`, что делает их доступными для вызова из JavaScript.
*   **Делегирование логики**: Большинство методов в `ScriptManager` не содержат сложной логики напрямую. Вместо этого они делегируют вызовы соответствующим методам в других классах, таких как `FormMain` (главная форма приложения) и `Map` (связанные с картой функции). Это указывает на четкое разделение обязанностей в архитектуре C#-клиента.

**Примеры методов и их назначение:**

*   `MapText()`: Возвращает текст, связанный с картой.
*   `CellDivText(int x, int y, int scale, string link, bool showmove, bool isframe)`: Возвращает HTML-строку для отображения информации о ячейке карты.
*   `IsAutoFish()`: Проверяет, включена ли функция авторыбалки.
*   `InsertGuaDiv(string code)`: Вставляет HTML-код, возможно, связанный с капчей или специальными элементами интерфейса.
*   `ChangeChatSize(int size)`, `ChangeChatSpeed(int delay)`, `ChangeChatMode(int mode)`: Управляют поведением чата.
*   `AutoSelect()`, `AutoTurn()`, `AutoBoi()`: Вероятно, связаны с автоматизацией игровых действий.
*   `MoveTo(string dest)`: Перемещает персонажа в указанное место.
*   `TraceDrinkPotion(string wnickname, string wnametxt)`: Отслеживает использование зелий.
*   `ShowMiniMap(bool show)`: Управляет видимостью мини-карты.
*   `ChatFilter(string message)`: Применяет фильтры к сообщениям чата.
*   `XodButtonElapsedTime()`: Возвращает время, прошедшее с последнего хода.
*   `InfoToolTip(string img, string alt)`: Возвращает HTML для всплывающих подсказок.
*   Множество методов `FastAttack*` и `CheckFastAttack*`: Связаны с автоматизацией боевых действий и проверкой условий для них.
*   `HerbsList(string list)`, `IsHerbAutoCut(string herb)`, `HerbCut(string name)`, `DoHerbAutoCut()`: Связаны с автоматизацией сбора трав.
*   `UsersOnline()`: Возвращает HTML-строку с информацией о количестве пользователей онлайн.
*   `StartBulkSell(...)`, `StartBulkOldSell(...)`, `StartBulkDrop(...)`: Связаны с автоматизацией торговли.
*   `SetNeverTimer(int msec)`: Устанавливает таймер.
*   `ShowHpMaTimers(...)`: Возвращает HTML-строку с информацией о HP/MP и таймерах.

**Связь с Android-портом:**

*   Все публичные методы этого класса, которые вызываются из JavaScript, должны быть воспроизведены в Kotlin с использованием `@JavascriptInterface`.
*   Логика, которую эти методы делегируют другим классам C#, должна быть портирована в соответствующие Kotlin-классы (например, `FormMain` -> `MainActivity` или `MainViewModel`, `Map` -> `MapManager` и т.д.).
*   Особое внимание следует уделить методам, которые возвращают HTML-строки (`MapText`, `CellDivText`, `UsersOnline`, `ShowHpMaTimers`, `InfoToolTip`), так как они напрямую влияют на отображение в WebView.
