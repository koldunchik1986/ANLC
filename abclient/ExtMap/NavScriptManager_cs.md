# Анализ NavScriptManager.cs

**Расположение:** `abclient/ExtMap/NavScriptManager.cs`

**Назначение:**
Этот класс, как и `ScriptManager.cs`, служит мостом между JavaScript и логикой C# приложения, но его специализация, судя по названию и содержимому, связана с функциями навигатора и карты. Он предоставляет методы, которые могут быть вызваны из JavaScript через объект `window.external` для взаимодействия с навигатором.

**Ключевые особенности:**

*   **`[ComVisible(true)]`**: Подтверждает, что этот класс также предназначен для взаимодействия с JavaScript через COM-интерфейс `window.external`.
*   **Зависимость от `FormNavigator`**: Класс принимает экземпляр `FormNavigator` в своем конструкторе, что указывает на его тесную связь с UI-компонентом навигатора.
*   **Делегирование логики**: Методы в `NavScriptManager` делегируют свою логику другим классам, таким как `FormMain` и `Map`. Это соответствует паттерну, наблюдаемому в `ScriptManager.cs`, и подчеркивает модульность C#-кода.

**Примеры методов и их назначение:**

*   `MoveTo(string dest)`: Вероятно, используется для перемещения персонажа к определенному месту назначения на карте, делегируя это `_formnavigator.PointToDest()`.
*   `GetCellLabel(int x, int y)`: Возвращает текстовую метку для ячейки карты по координатам.
*   `IsCellExists(int x, int y)`: Проверяет существование ячейки карты.
*   `IsCellInPath(int x, int y)`: Проверяет, находится ли ячейка на текущем пути навигации.
*   `GenMoveLink(int x, int y)`: Генерирует ссылку для перемещения к ячейке.
*   `CellDivText(int x, int y, int scale, string link, bool showmove, bool isframe)`: Возвращает HTML-строку для отображения информации о ячейке карты.
*   `CellAltText(int x, int y, int scale)`: Возвращает альтернативный текст для ячейки карты.

**Связь с Android-портом:**

*   Методы этого класса, вызываемые из JavaScript, также должны быть воспроизведены в Kotlin с использованием `@JavascriptInterface`.
*   Логика, делегируемая `FormMain` и `Map`, должна быть портирована в соответствующие Kotlin-классы.
*   Особое внимание к методам, возвращающим HTML-строки (`CellDivText`), так как они напрямую влияют на отображение в WebView.
*   Зависимость от `FormNavigator` означает, что при портировании потребуется соответствующий компонент UI или ViewModel для обработки навигационной логики.
