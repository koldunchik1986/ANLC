# План портирования ANLC на Android

Этот документ отслеживает прогресс полной переработки Android-приложения на основе C# версии.

## Этап 1: Создание чистого фундамента (ОСНОВА)

- [x] Полностью удалить старую кодовую базу.
- [x] Создать новую, чистую структуру пакетов (`data`, `di`, `domain`, `ui`, `util`).
- [x] Добавить современные библиотеки в `build.gradle` (Kotlin, Coroutines, Retrofit, OkHttp, Gson).
- [x] Временно отключить Hilt (из-за проблем совместимости со средой).
- [x] Собрать проект с новой структурой и зависимостями для подтверждения работоспособности фундамента.

## Этап 2: Перенос основной логики (ЯДРО)

### 2.1. Управление профилями
- [x] Создать data class `Profile.kt` с основными полями из `UserConfig.cs`.
- [x] Создать `CryptoHelper.kt` для воссоздания логики шифрования из `Crypts.cs`.
    - [x] Реализовать шифрование/дешифрование `TripleDES`.
    - [x] Реализовать хеширование `MD5`.
- [x] Создать `ProfileManager.kt` для управления профилями.
    - [x] Реализовать сохранение/загрузку профилей в `profiles.json` с помощью Gson.
    - [ ] Интегрировать `CryptoHelper` для шифрования/дешифрования данных профиля. (Это будет сделано на уровне UI)

### 2.2. Сетевое взаимодействие и авторизация
- [x] Создать `AuthInterceptor.kt` (`OkHttp Interceptor`).
- [x] Создать `ApiClient.kt` (Retrofit-интерфейс).
- [x] Создать фабрику `ApiClientFactory` для ручного создания зависимостей.
- [x] Создать единый `AuthRepository.kt` (репозиторий авторизации).
    - [x] Реализовать метод `authorize()`, который будет использовать `ApiClient` и `AuthInterceptor`.
    - [x] Реализовать метод `startSessionHeartbeat()` для "пульса" сессии.
    - [x] Реализовать метод `isLoggedIn()` на основе наличия сессионных кук.
    - [x] Реализовать метод `logout()` (включая очистку `AuthInterceptor` и `ProfileManager`).

## Этап 3: Перестройка пользовательского интерфейса (UI)

### 3.1. Базовые компоненты UI
- [x] Создать базовые классы `BaseActivity.kt`, `BaseFragment.kt`, `BaseViewModel.kt`.

### 3.2. Экран входа и управления профилями
- [x] Создать `ProfileViewModel.kt` для логики экрана.
- [x] Создать `ProfilesActivity.kt` (или Fragment) для отображения списка профилей и управления ими (создание, редактирование, удаление).
- [x] Реализовать ввод пароля для входа (диалог).
- [x] Реализовать создание/редактирование профилей (новая Activity/Dialog).

### 3.3. Главный экран
- [x] Создать `MainViewModel.kt` для логики главного экрана.
- [x] Создать `MainActivity.kt`.
- [x] Реализовать `WebView` для отображения игрового контента.
    - [x] Реализовать `WebViewClient` и переопределить `shouldOverrideUrlLoading`.
    - [x] Реализовать `WebViewClient` и переопределить `onPageFinished`.
    - [x] Реализовать `WebViewClient` и переопределить `shouldInterceptRequest`.
    - [x] Синхронизировать куки между `WebView` и `OkHttp`.
    - [x] Реализовать внедрение JavaScript.
- [x] Реализовать и запустить "пульс" сессии (`startSessionHeartbeat`) из `MainViewModel`.
- [x] Реализовать обновление UI (часы) на основе данных от "пульса" через `LiveData` или `StateFlow`.
- [x] Реализовать отображение логов (используя уже созданные `LogListActivity` и `LogViewerActivity`).
- [ ] Перенести остальные элементы UI и их логику (чат, навигатор и т.д.).